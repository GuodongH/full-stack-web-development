# 容器化你的 Angular 应用

## 什么是容器？

容器其实可以理解成一个硬件虚拟化后的运行镜像，如果认为虚拟机是模拟运行的一套操作系统（提供了运行态环境和其他系统环境）和跑在上面的应用。那么 Docker 容器就是独立运行的一个或一组应用以及它们的运行环境。

![虚拟机和容器架构](/assets/2018-03-09-11-50-35.png)

图中左侧是虚拟机的架构，图中的例子有4个操作系统（Operating System）。他们是 1 个 Host Operating System 和  3 个 Guest Operating System，每个虚拟机中都有一个独立的Kernel。虚拟机可以让你能充分利用你的硬件资源。你可以购买性能超强的物理机器，然后在上面运行多个虚拟机。你可以有一个数据库虚拟机以及很多运行相同版本的定制应用程序的虚拟机所构成的集群。你可以在有限的硬件资源获得很多的扩展能力。如果你觉得你需要更多的虚拟机而且你的宿主硬件还有容量，你可以添加任何你需要的虚拟机。如果你不再需要一个虚拟机，你可以关闭该虚拟机甚至删除虚拟机镜像。但虚拟机的缺陷在于所有分配给一个虚拟机的资源是专有的。假如一台物理主机有 8 GB 的内存，如果我们建立一个拥有 1G 内存的虚拟机，那么它只会使用这 1GB 内测，即使内存不足，它也不会动用剩余的 7 GB 内存。没有资源的动态分配，每台虚拟机**拥有且只能使用**分配给它的资源。

而图中右侧为容器架构，容器其实是一个进程，操作系统认为它只是一个运行中的进程。另外，该容器进程也分配了它自己的 IP 地址。一旦有了一个 IP 地址，该进程就是宿主网络中可识别的资源。然后，你可以在容器管理器上运行命令，使容器 IP 映射到主机中能访问公网的 IP 地址。建立了该映射，容器就是网络上一个可访问的独立机器，从概念上类似于虚拟机。

因为容器是一个进程，所以它可以动态的共享主机上的资源。如果容器只需要 1GB 内存，它就只会使用 1GB。如果它需要 4GB，就会使用 4GB。CPU 和硬盘等也是如此。和典型虚拟机的静态方式不同。所有这些资源的共享都由容器管理器来管理。而且，由于摆脱了硬件虚拟化，容器可以非常快速地启动。

容器的好处是：既有虚拟机独立和封装的优点，又屏蔽了静态资源专有的缺陷，可以共享资源。另外，由于容器能快速加载到内存，在扩展到多个容器时你能获得更好的性能。

那么对于开发者来说，现在由于容器既快速又方便，这就解决了部署的痛苦。有经验的开发者都知道开发环境好用的应用到了生产环境会出现各种问题，因为现代的软件依赖很多第三方类库和其他环境支持，稍微有点变化就会导致程序无法正确运行。 Docker 给开发者带来的好处就是可以让开发环境和生产环境一致，无缝部署到生产环境。

## 安装 Docker

一般来说在 Linux 主机上，可以使用官方的安装脚本，国内的各种云服务购买的 Linux 虚拟机上都可以这么安装。

```bash
curl -sSL https://get.docker.com/ | sh
```

在 Mac 或者 Windows 上面，需要到 https://www.docker.com/community-edition#/download 下载官方的安装包

![为 Windows 或 Mac 下载 Docker](/assets/2018-03-09-12-21-09.png)

## 镜像仓库加速

由于众所周知的原因，很多开源的开发工具或软件仓库都在国内访问速度欠佳，这时候一般采用的都是使用国内的镜像进行加速。Docker 也不例外，我们这里提供一种使用腾讯云提供的 docker 软件镜像仓库，可以加速镜像下载。

在 Linux 系统中可以采用下面脚本进行设置

```bash
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://mirror.ccs.tencentyun.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

如果是
